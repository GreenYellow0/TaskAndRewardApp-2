<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tasks and Rewards</title>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <a href="/dashboard">Back to Dashboard</a>
  
  <h2>Tasks</h2>
  <form id="taskForm" action="/saveTask" method="POST">
    <input type="text" name="task" placeholder="Enter a task" required>
    <input type="number" name="coins" placeholder="Enter coins" required>
    <button type="submit">Save Task</button>
  </form>
  
  <% if (user.tasks && user.tasks.length > 0) { %>
    <ul>
      <% user.tasks.forEach(task => { %>
        <li>
          <%= task.task %> - <%= task.coins %> coins
          <button class="removeTask" data-task-id="<%= task._id %>">Remove</button>
        </li>
      <% }) %>
    </ul>
  <% } else { %>
    <p>No tasks found.</p>
  <% } %>
  
  <h2>Rewards</h2>
  <form id="rewardForm" action="/saveReward" method="POST">
    <input type="text" name="reward" placeholder="Enter a reward" required>
    <input type="number" name="cost" placeholder="Enter cost" required>
    <button type="submit">Save Reward</button>
  </form>
  
  <% if (user.rewards && user.rewards.length > 0) { %>
    <ul>
      <% user.rewards.forEach(reward => { %>
        <li>
          <%= reward.reward %> - <%= reward.cost %> coins
          <button class="removeReward" data-reward-id="<%= reward._id %>">Remove</button>
        </li>
      <% }) %>
    </ul>
  <% } else { %>
    <p>No rewards found.</p>
  <% } %>
  

  <script src="/script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const removeTaskButtons = document.querySelectorAll('.removeTask');
      const removeRewardButtons = document.querySelectorAll('.removeReward');
  
      removeTaskButtons.forEach(button => {
        button.addEventListener('click', () => {
          const taskId = button.dataset.taskId;
          removeTask(taskId);
        });
      });
  
      removeRewardButtons.forEach(button => {
        button.addEventListener('click', () => {
          const rewardId = button.dataset.rewardId;
          removeReward(rewardId);
        });
      });
  
      function removeTask(taskId) {
        fetch('/removeTask', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ taskId })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              location.reload();
            }
          })
          .catch(err => {
            console.error(err);
          });
      }
  
      function removeReward(rewardId) {
        fetch('/removeReward', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ rewardId })
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              location.reload();
            }
          })
          .catch(err => {
            console.error(err);
          });
      }
    });
  </script>
  
  
  
</body>
</html>
